**Query1 - What were the total rental orders for each store?**

WITH T1 AS (SELECT 
DATE_PART('MONTH',RENTAL_DATE)AS MONTH,
DATE_PART('YEAR',RENTAL_DATE) AS YEAR,
STORE.STORE_ID AS STORE_ID,
COUNT(STORE.STORE_ID) AS COUNT1
FROM RENTAL
JOIN STAFF
ON RENTAL.STAFF_ID=STAFF.STAFF_ID
JOIN STORE
ON STORE.STORE_ID=STAFF.STORE_ID
GROUP BY RENTAL.RENTAL_DATE,STORE.STORE_ID
ORDER BY YEAR,MONTH)
SELECT MONTH,YEAR,STORE_ID,COUNT(COUNT1) AS COUNT_RENTALS
FROM T1
GROUP BY T1.MONTH,T1.YEAR,T1.STORE_ID
ORDER BY COUNT_RENTALS DESC;


** Query2 - How many family movies are rented?**

SELECT TITLE AS TITLE,
NAME AS CATEGORY_NAME,
COUNT(*) AS RENTAL_COUNT
FROM FILM
JOIN FILM_CATEGORY
ON FILM.FILM_ID=FILM_CATEGORY.FILM_ID
JOIN CATEGORY
ON CATEGORY.CATEGORY_ID=FILM_CATEGORY.CATEGORY_ID
JOIN INVENTORY
ON INVENTORY.FILM_ID=FILM.FILM_ID
JOIN RENTAL
ON INVENTORY.INVENTORY_ID=RENTAL.INVENTORY_ID
WHERE NAME IN ('Animation' , 'Family' , 'Children' , 'Classics' , 'Comedy' , 'Music')
GROUP BY TITLE,NAME
ORDER BY NAME,RENTAL_COUNT DESC,TITLE;


** Query3 - What is the geographical distribution of our customers?**

SELECT COUNTRY,COUNT(COUNTRY) AS COUNT_CUSTOMERS
FROM COUNTRY
JOIN CITY
ON COUNTRY.COUNTRY_ID=CITY.COUNTRY_ID
JOIN ADDRESS
ON ADDRESS.CITY_ID=CITY.CITY_ID
JOIN CUSTOMER 
ON ADDRESS.ADDRESS_ID=CUSTOMER.ADDRESS_ID
GROUP BY COUNTRY.COUNTRY
ORDER BY COUNT_CUSTOMERS DESC;


** Query4 - Who are the top 10 customers in March 2007?**

SELECT CUSTOMER_NAME , PAYMENT_DATE, SUM(AMOUNT),COUNT(AMOUNT)
FROM(SELECT CONCAT(FIRST_NAME, ' ', LAST_NAME) AS CUSTOMER_NAME,DATE_TRUNC('MONTH',PAYMENT_DATE) AS PAYMENT_DATE,SUM(AMOUNT) OVER (PARTITION BY CONCAT(FIRST_NAME, ' ', LAST_NAME)ORDER BY PAYMENT_DATE) AS SUM_AMOUNT, AMOUNT
FROM CUSTOMER
JOIN PAYMENT
ON PAYMENT.CUSTOMER_ID=CUSTOMER.CUSTOMER_ID) AS T1
WHERE PAYMENT_DATE = '2007-03-01T00:00:00.000Z'
GROUP BY T1.NAME,T1.PAYMENT_DATE
ORDER BY SUM DESC 
LIMIT 10;
